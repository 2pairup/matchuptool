var __reflect=this&&this.__reflect||function(t,e,a){t.__class__=e,a?a.push(e):a=[e],t.__types__=t.__types__?a.concat(t.__types__):a},__extends=this&&this.__extends||function(t,e){function a(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);a.prototype=e.prototype,t.prototype=new a},__awaiter=this&&this.__awaiter||function(t,e,a,r){return new(a||(a=Promise))(function(n,i){function s(t){try{h(r.next(t))}catch(e){i(e)}}function o(t){try{h(r["throw"](t))}catch(e){i(e)}}function h(t){t.done?n(t.value):new a(function(e){e(t.value)}).then(s,o)}h((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function a(t){return function(e){return r([t,e])}}function r(a){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,i&&(s=i[2&a[0]?"return":a[0]?"throw":"next"])&&!(s=s.call(i,a[1])).done)return s;switch(i=0,s&&(a=[0,s.value]),a[0]){case 0:case 1:s=a;break;case 4:return h.label++,{value:a[1],done:!1};case 5:h.label++,i=a[1],a=[0];continue;case 7:a=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===a[0]||2===a[0])){h=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){h.label=a[1];break}if(6===a[0]&&h.label<s[1]){h.label=s[1],s=a;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(a);break}s[2]&&h.ops.pop(),h.trys.pop();continue}a=e.call(t,h)}catch(r){a=[6,r],i=0}finally{n=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var n,i,s,o,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,a){function r(r){e.call(a,r,t)}if(RES.hasRes(t)){var n=RES.getRes(t);n?r(n):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var GlobalStore=function(t){function e(){var e=t.call(this)||this;return e.yr3Match=["申申","子子","辰辰","申子","申辰","子辰","子申","辰子","辰申","巳巳","酉酉","丑丑","巳酉","巳丑","酉丑","酉巳","丑巳","丑酉","寅寅","午午","戌戌","寅午","寅戌","午戌","午寅","戌午","戌寅","亥亥","卯卯","未未","亥卯","亥未","卯未","卯亥","未卯","未亥"],e.yr6Match=["子丑","寅亥","卯戌","辰酉","巳申","午未","丑子","亥寅","戌卯","酉辰","申巳","未午"],e.starMatch=["山羊金牛","山羊處女","金牛處女","金牛山羊","處女金牛","處女山羊","水瓶雙子","水瓶天秤","雙子天秤","雙子水瓶","天秤水瓶","天秤雙子","白羊獅子","白羊射手","獅子射手","獅子白羊","射手白羊","射手獅子","雙魚巨蟹","雙魚天蠍","巨蟹天蠍","巨蟹雙魚","天蠍雙魚","天蠍巨蟹","山羊山羊","金牛金牛","處女處女","水瓶水瓶","雙子雙子","天秤天秤","白羊白羊","獅子獅子","射手射手","雙魚雙魚","巨蟹巨蟹","天蠍天蠍"],e.stemMatch=["甲己","乙庚","丙辛","丁壬","戊癸","己甲","庚乙","辛丙","壬丁","癸戊"],e.stemMFMatch=["甲男己女","乙女庚男","丙男辛女","丁女壬男","戊男癸女"],e.coldHotMatch=["春秋","春冬","夏秋","夏冬","秋春","冬春","秋夏","冬夏"],e.seasonMatch=["春秋","夏冬","秋春","冬夏"],e.branch6Match=["子丑","寅亥","卯戌","辰酉","巳申","午未","丑子","亥寅","戌卯","酉辰","申巳","未午"],e.constellationMatch=["角虚","角觜","虚觜","虚角","觜虚","觜角","亢危","亢参","危参","危亢","参亢","参危","氐室","氐井","室井","室氐","井氐","井室","房壁","房鬼","壁鬼","壁房","鬼房","鬼壁","心奎","心柳","奎柳","奎心","柳心","柳奎","尾娄","尾星","娄星","娄尾","星尾","尾娄","张箕","张胃","箕胃","箕张","胃张","胃箕","昴翼","昴斗","翼斗","翼昴","斗昴","斗翼","毕轸","毕女","轸女","轸毕","女毕","女轸","角角","亢亢","氐氐","房房","心心","尾尾","箕箕","斗斗","女女","虚虚","危危","室室","壁壁","奎奎","娄娄","胃胃","昴昴","毕毕","觜觜","参参","井井","鬼鬼","柳柳","星星","张张","翼翼","轸轸"],e.playerDatas=[],e.mPlayerDatas=[],e.fPlayerDatas=[],e.resultPlayerDatas=[],e}return __extends(e,t),e.prototype.updatePlayerDatas=function(t){var e=this;this.playerDatas=t,this.playerDatas.forEach(function(t){"M"===t.sex?e.mPlayerDatas.push(t):e.fPlayerDatas.push(t)})},e.prototype.getPlayerData=function(t){var e=null;return this.playerDatas.forEach(function(a){a.Name===t&&(e=a)}),e},e.prototype.searchAndGetMatchPlayerData=function(t){var e=this,a=[],r=(new Map,[]);return r="M"===t.sex?this.fPlayerDatas:this.mPlayerDatas,r.forEach(function(r){if("Advance"===t.Membership||"VIP"===t.Membership){if(e.getMarkCount(t,r)>=3){var n={playerData:r,mark:e.getTotalMark(t,r)};a.push(n)}}else if(e.getMarkCount(t,r)>=2){var n={playerData:r,mark:e.getTotalMark(t,r)};a.push(n)}}),a.sort(function(t,e){return t.mark<e.mark?1:e.mark<t.mark?-1:0}),a},e.prototype.getYrMark=function(t,e){var a=0,r=t.year+e.year;return a=Math.max(a,this.countYr3Match(r)),("Advance"===t.Membership||"VIP"===t.Membership)&&(a=Math.max(a,this.countYr6Match(r))),a},e.prototype.countYr3Match=function(t){return this.yr3Match.indexOf(t)>=0?30:0},e.prototype.countYr6Match=function(t){return this.yr6Match.indexOf(t)>=0?25:0},e.prototype.getStarMark=function(t,e){var a=0,r=t.star+e.star;return a=Math.max(a,this.countStarMatch(r))},e.prototype.countStarMatch=function(t){return this.starMatch.indexOf(t)>=0?23:0},e.prototype.getStemMark=function(t,e){var a=0,r=t.stem+e.stem,n=t.stem;return n+="M"===t.sex?"男":"女",n+=e.stem,n+="M"===e.sex?"男":"女",a=Math.max(a,this.countStemMatch(r)),("Advance"===t.Membership||"VIP"===t.Membership)&&(a=Math.max(a,this.countStemMFMatch(n))),a},e.prototype.countStemMatch=function(t){return this.stemMatch.indexOf(t)>=0?28:0},e.prototype.countStemMFMatch=function(t){return this.stemMFMatch.indexOf(t)>=0?40:0},e.prototype.getSeasonMark=function(t,e){var a=0,r=t.season+e.season;return a=Math.max(a,this.countColdHotMatch(r)),("Advance"===t.Membership||"VIP"===t.Membership)&&(a=Math.max(a,this.countSeasonMatch(r))),a},e.prototype.countColdHotMatch=function(t){return this.coldHotMatch.indexOf(t)>=0?27:0},e.prototype.countSeasonMatch=function(t){return this.seasonMatch.indexOf(t)>=0?40:0},e.prototype.getBranchMark=function(t,e){var a=0,r=t.branch+e.branch;return("Advance"===t.Membership||"VIP"===t.Membership)&&(a=Math.max(a,this.countBranch6Match(r))),a},e.prototype.countBranch6Match=function(t){return this.branch6Match.indexOf(t)>=0?13:0},e.prototype.getConstellationMark=function(t,e){var a=0,r=t.constellation+e.constellation;return("Advance"===t.Membership||"VIP"===t.Membership)&&(a=Math.max(a,this.countConstellationMatch(r))),a},e.prototype.countConstellationMatch=function(t){return this.constellationMatch.indexOf(t)>=0?30:0},e.prototype.getTotalMark=function(t,e){var a=0;return a+=this.getYrMark(t,e),a+=this.getStarMark(t,e),a+=this.getStemMark(t,e),a+=this.getSeasonMark(t,e),a+=this.getBranchMark(t,e),a+=this.getConstellationMark(t,e)},e.prototype.getMarkCount=function(t,e){var a=0;return this.getYrMark(t,e)>0&&a++,this.getStarMark(t,e)>0&&a++,this.getStemMark(t,e)>0&&a++,this.getSeasonMark(t,e)>0&&a++,this.getBranchMark(t,e)>0&&a++,this.getConstellationMark(t,e)>0&&a++,a},e.prototype.getInAppMark=function(t,e){var a=this.getTotalMark(t,e),r="0%+";return"VIP"===t.Membership?a>=161?r="98%":a>=141?r="97%":a>=121?r="96%":a>=96?r="95%":69>=a?r="70%":r+="%":"Advance"===t.Membership?a>=81?r="70%+":a>=61?r="60%+":a>=50?r="50%+":a>=0&&(r="40%+"):a>=40&&(r="40%+"),r},e}(egret.EventDispatcher);__reflect(GlobalStore.prototype,"GlobalStore"),window.globalStore||(window.globalStore=new GlobalStore);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),t=new MainPage,this.addChild(t),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return a.sent(),[4,this.loadTheme()];case 2:return a.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return a.sent(),this.stage.removeChild(t),[3,5];case 4:return e=a.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,a){var r=new eui.Theme("resource/default.thm.json",t.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){console.log("createGameScene");var t=this.createBitmapByName("bg_jpg");this.addChild(t);var e=this.stage.stageWidth,a=this.stage.stageHeight;t.width=e,t.height=a;var r=new egret.Shape;r.graphics.beginFill(0,.5),r.graphics.drawRect(0,0,e,172),r.graphics.endFill(),r.y=33,this.addChild(r);var n=this.createBitmapByName("egret_icon_png");this.addChild(n),n.x=26,n.y=33;var i=new egret.Shape;i.graphics.lineStyle(2,16777215),i.graphics.moveTo(0,0),i.graphics.lineTo(0,117),i.graphics.endFill(),i.x=172,i.y=61,this.addChild(i);var s=new egret.TextField;s.textColor=16777215,s.width=e-172,s.textAlign="center",s.text="Hello Egret",s.size=24,s.x=172,s.y=80,this.addChild(s);var o=new egret.TextField;this.addChild(o),o.alpha=0,o.width=e-172,o.textAlign=egret.HorizontalAlign.CENTER,o.size=24,o.textColor=16777215,o.x=172,o.y=135,this.textfield=o;var h=new eui.Button;h.label="Click!",h.horizontalCenter=0,h.verticalCenter=0,this.addChild(h),h.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,a=RES.getRes(t);return e.texture=a,e},e.prototype.startAnimation=function(t){var e=this,a=new egret.HtmlTextParser,r=t.map(function(t){return a.parse(t)}),n=this.textfield,i=-1,s=function(){i++,i>=r.length&&(i=0);var t=r[i];n.textFlow=t;var a=egret.Tween.get(n);a.to({alpha:1},200),a.wait(2e3),a.to({alpha:0},200),a.call(s,e)};s()},e.prototype.onButtonClick=function(t){var e=new eui.Panel;e.title="Title",e.horizontalCenter=0,e.verticalCenter=0,this.addChild(e)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var MainPage=function(t){function e(){var e=t.call(this)||this;return e.skinName="skins.mainPageSkin",e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.globalStore=new GlobalStore,this.loadCsv(),this.nameInput.text="F1",this.importBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.importBtnOnClick,this),this.enterBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.enterBtnOnClick,this)},e.prototype.loadCsv=function(){var t=this,e=new Promise(function(e,a){RES.getResByUrl("resource/assets/Csv/inputFile.csv",function(a,r){for(var n=a.split("\n"),i=[],s=n[0].split(","),o=[],h=1;h<n.length;h++){for(var l=[],a=n[h].split(","),c={},u=0;u<a.length;u++)c[s[u].trim()]=a[u].trim(),"Actions"===s[u].trim()?l.Actions=a[u].trim():"Assignee"===s[u].trim()?l.Assignee=a[u].trim():"Chatroom"===s[u].trim()?l.Chatroom=a[u].trim():"Membership"===s[u].trim()?l.Membership=a[u].trim():"Name"===s[u].trim()?l.Name=a[u].trim():"出生日期"===s[u].trim()?l.birth=a[u].trim():"四季"===s[u].trim()?l.season=a[u].trim():"天干"===s[u].trim()?l.stem=a[u].trim():"年份"===s[u].trim()?l.year=a[u].trim():"性別"===s[u].trim()?l.sex=a[u].trim():"日元地支"===s[u].trim()?l.branch=a[u].trim():"星宿"===s[u].trim()?l.constellation=a[u].trim():"星座"===s[u].trim()&&(l.star=a[u].trim());i.push(c),o.push(l)}JSON.stringify(i),t.globalStore.updatePlayerDatas(o),e()},t,RES.ResourceItem.TYPE_TEXT)});e.then(function(t){})},e.prototype.importBtnOnClick=function(){},e.prototype.enterBtnOnClick=function(){if(this.globalStore.getPlayerData(this.nameInput.text)){var t=new ResultPage(this.globalStore,this.nameInput.text);this.addChild(t),this.msgLabel.text=""}else this.msgLabel.text="no this person"},e}(eui.Component);__reflect(MainPage.prototype,"MainPage");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ResultPage=function(t){function e(e,a){var r=t.call(this)||this;return r.globalStore=e,r.userName=a,r.pageIndex=0,r.skinName="skins.resultPageSkin",r}return __extends(e,t),e.prototype.createChildren=function(){return __awaiter(this,void 0,void 0,function(){var e,a=this;return __generator(this,function(r){return t.prototype.createChildren.call(this),this.backBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.backBtnOnClick,this),this.previousBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.previousBtnOnClick,this),this.nextBtn.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.nextBtnOnClick,this),this.ownData=this.globalStore.getPlayerData(this.userName),this.resultData=this.globalStore.searchAndGetMatchPlayerData(this.ownData),e=0,this.resultData.forEach(function(t){var r=a.globalStore.getTotalMark(a.ownData,t.playerData),n=new ResultRowButton(a,t.playerData.Name,r,e);a.resultScrollerGrp.addChild(n),e++}),this.updateTable(),[2]})})},e.prototype.backBtnOnClick=function(){this.parent.removeChild(this)},e.prototype.previousBtnOnClick=function(){this.pageIndex--,this.pageIndex<0&&(this.pageIndex=0),this.updateTable()},e.prototype.nextBtnOnClick=function(){this.pageIndex++,this.pageIndex>=this.resultData.length&&(this.pageIndex=this.resultData.length-1),this.updateTable()},e.prototype.updateTable=function(){console.error("this.pageIndex: ",this.pageIndex),console.error("this.resultData[this.pageIndex]: ",this.resultData[this.pageIndex]),this.nameABLbl.text="",this.assigneeABLbl.text="",this.membershipABLbl.text="",this.yrABLbl.text=this.ownData.year+this.resultData[this.pageIndex].playerData.year,this.starABLbl.text=this.ownData.star+this.resultData[this.pageIndex].playerData.star,this.stemABLbl.text=this.ownData.stem+this.resultData[this.pageIndex].playerData.stem,this.seasonABLbl.text=this.ownData.season+this.resultData[this.pageIndex].playerData.season,this.branchABLbl.text=this.ownData.branch+this.resultData[this.pageIndex].playerData.branch,this.constellationABLbl.text=this.ownData.constellation+this.resultData[this.pageIndex].playerData.constellation,this.actualABLbl.text="",this.inAppABLbl.text="",this.nameALbl.text=this.ownData.Name,this.assigneeALbl.text=this.ownData.Assignee,this.membershipALbl.text=this.ownData.Membership,this.yrALbl.text=this.globalStore.getYrMark(this.ownData,this.resultData[this.pageIndex].playerData).toString(),this.starALbl.text=this.globalStore.getStarMark(this.ownData,this.resultData[this.pageIndex].playerData).toString(),this.stemALbl.text=this.globalStore.getStemMark(this.ownData,this.resultData[this.pageIndex].playerData).toString(),this.seasonALbl.text=this.globalStore.getSeasonMark(this.ownData,this.resultData[this.pageIndex].playerData).toString(),this.branchALbl.text=this.globalStore.getBranchMark(this.ownData,this.resultData[this.pageIndex].playerData).toString(),this.constellationALbl.text=this.globalStore.getConstellationMark(this.ownData,this.resultData[this.pageIndex].playerData).toString(),this.actualALbl.text=this.globalStore.getTotalMark(this.ownData,this.resultData[this.pageIndex].playerData).toString(),this.inAppALbl.text=this.globalStore.getInAppMark(this.ownData,this.resultData[this.pageIndex].playerData).toString(),this.nameBLbl.text=this.resultData[this.pageIndex].playerData.Name,this.assigneeBLbl.text=this.resultData[this.pageIndex].playerData.Assignee,this.membershipBLbl.text=this.resultData[this.pageIndex].playerData.Membership,this.yrBLbl.text=this.globalStore.getYrMark(this.resultData[this.pageIndex].playerData,this.ownData).toString(),this.starBLbl.text=this.globalStore.getStarMark(this.resultData[this.pageIndex].playerData,this.ownData).toString(),this.stemBLbl.text=this.globalStore.getStemMark(this.resultData[this.pageIndex].playerData,this.ownData).toString(),this.seasonBLbl.text=this.globalStore.getSeasonMark(this.resultData[this.pageIndex].playerData,this.ownData).toString(),this.branchBLbl.text=this.globalStore.getBranchMark(this.resultData[this.pageIndex].playerData,this.ownData).toString(),this.constellationBLbl.text=this.globalStore.getConstellationMark(this.resultData[this.pageIndex].playerData,this.ownData).toString(),this.actualBLbl.text=this.globalStore.getTotalMark(this.resultData[this.pageIndex].playerData,this.ownData).toString(),this.inAppBLbl.text=this.globalStore.getInAppMark(this.resultData[this.pageIndex].playerData,this.ownData).toString(),this.pageNumberLbl.text=this.pageIndex+1+"/"+this.resultData.length},e}(eui.Component);__reflect(ResultPage.prototype,"ResultPage");var ResultRowButton=function(t){function e(e,a,r,n){var i=t.call(this)||this;return i._resultPage=e,i._sUserName=a,i._nMark=r,i._nIndex=n,i.skinName="skins.resultRowButtonSkin",i}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.btnEnter.label=this._sUserName,this.lblMark.text=this._nMark.toString(),this.btnEnter.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.btnEnterOnClick,this)},e.prototype.btnEnterOnClick=function(){this._resultPage.pageIndex=this._nIndex,this._resultPage.updateTable()},e}(eui.Component);__reflect(ResultRowButton.prototype,"ResultRowButton");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,a,r){function n(t){e.call(r,t)}function i(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),a.call(r))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,a){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(r,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var o=t.split("/");o.pop();var h=o.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(r,generateJSON.paths[t])},this):RES.getResByUrl(h,function(a){window.JSONParseClass.setData(a),egret.callLater(function(){e.call(r,generateJSON.paths[t])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,i,null),RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);